!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.media=redux.field_objects.media||{};var i;e(document).ready(function(){}),redux.field_objects.media.init=function(d){d||(d=e(document).find(".redux-group-tab:visible").find(".redux-container-media:visible")),e(d).each(function(){var d=e(this),t=d;d.hasClass("redux-field-container")||(t=d.parents(".redux-field-container:first")),t.is(":hidden")||t.hasClass("redux-field-init")&&(t.removeClass("redux-field-init"),i=!1,d.find(".remove-image, .remove-file").unbind("click").on("click",function(){redux.field_objects.media.removeFile(e(this).parents("fieldset.redux-field:first"))}),d.find(".media_upload_button").unbind().on("click",function(i){redux.field_objects.media.addFile(i,e(this).parents("fieldset.redux-field:first"))}))})},redux.field_objects.media.addFile=function(d,t){d.preventDefault();var a,n,o=e(this);if(a)a.open();else{var r=e(t).find(".library-filter").data("lib-filter");void 0!==r&&""!==r&&(n=[],i=!0,r=decodeURIComponent(r),r=JSON.parse(r),e.each(r,function(e,i){n.push(i)})),(a=wp.media({multiple:!1,library:{type:n},title:o.data("choose"),button:{text:o.data("update")}})).on("select",function(){var d=a.state().get("selection").first();a.close();var n=e(t).find(".data").data();if(void 0!==redux.field_objects.media&&void 0!==typeof redux.field_objects.media||(redux.field_objects.media={}),void 0!==n&&"undefined"!==n.mode||((n={}).mode="image"),!0===i&&(n.mode=0),0===n.mode);else if(!1!==n.mode&&d.attributes.type!==n.mode&&d.attributes.subtype!==n.mode)return;t.find(".upload").val(d.attributes.url),t.find(".upload-id").val(d.attributes.id),t.find(".upload-height").val(d.attributes.height),t.find(".upload-width").val(d.attributes.width),redux_change(e(t).find(".upload-id"));var o=d.attributes.url;if(void 0!==d.attributes.sizes&&void 0!==d.attributes.sizes.thumbnail)o=d.attributes.sizes.thumbnail.url;else if(void 0!==d.attributes.sizes){var r=d.attributes.height;for(var s in d.attributes.sizes){var u=d.attributes.sizes[s];u.height<r&&(r=u.height,o=u.url)}}else o=d.attributes.icon;t.find(".upload-thumbnail").val(o),t.find(".upload").hasClass("noPreview")||t.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+o+'">').slideDown("fast"),t.find(".remove-image").removeClass("hide"),t.find(".redux-background-properties").slideDown()}),a.open()}},redux.field_objects.media.removeFile=function(i){i.find(".remove-image").addClass("hide")&&(i.find(".remove-image").addClass("hide"),i.find(".upload").val(""),i.find(".upload-id").val(""),i.find(".upload-height").val(""),i.find(".upload-width").val(""),i.find(".upload-thumbnail").val(""),redux_change(e(i).find(".upload-id")),i.find(".redux-background-properties").hide(),i.find(".screenshot").slideUp(),i.find(".remove-file").unbind(),i.find(".section-upload .upload-notice").length>0&&i.find(".media_upload_button").remove())}}(jQuery);