var frame,tawcvs=tawcvs||{};jQuery(document).ready(function(t){"use strict";function e(){i.find(".tawcvs-term-name input, .tawcvs-term-slug input").val(""),n.removeClass("is-active"),r.removeClass("error success").hide(),i.hide()}var a=window.wp,s=t("body");t("#term-color").wpColorPicker(),s.on("click",".tawcvs-upload-image-button",function(e){e.preventDefault();var s=t(this);frame?frame.open():((frame=a.media.frames.downloadable_file=a.media({title:tawcvs.i18n.mediaTitle,button:{text:tawcvs.i18n.mediaButton},multiple:!1})).on("select",function(){var t=frame.state().get("selection").first().toJSON();s.siblings("input.tawcvs-term-image").val(t.id),s.siblings(".tawcvs-remove-image-button").show(),s.parent().prev(".tawcvs-term-image-thumbnail").find("img").attr("src",t.sizes.thumbnail.url)}),frame.open())}).on("click",".tawcvs-remove-image-button",function(){var e=t(this);return e.siblings("input.tawcvs-term-image").val(""),e.siblings(".tawcvs-remove-image-button").show(),e.parent().prev(".tawcvs-term-image-thumbnail").find("img").attr("src",tawcvs.placeholder),!1});var i=t("#tawcvs-modal-container"),n=i.find(".spinner"),r=i.find(".message"),c=null;s.on("click",".tawcvs_add_new_attribute",function(e){e.preventDefault();var s=t(this),n=a.template("tawcvs-input-tax"),r={type:s.data("type"),tax:s.closest(".woocommerce_attribute").data("taxonomy")};i.find(".tawcvs-term-swatch").html(t("#tmpl-tawcvs-input-"+r.type).html()),i.find(".tawcvs-term-tax").html(n(r)),"color"==r.type&&i.find("input.tawcvs-input-color").wpColorPicker(),c=s.closest(".woocommerce_attribute.wc-metabox"),i.show()}).on("click",".tawcvs-modal-close, .tawcvs-modal-backdrop",function(t){t.preventDefault(),e()}),s.on("click",".tawcvs-new-attribute-submit",function(s){s.preventDefault();t(this).data("type");var o=!1,l={};i.find(".tawcvs-input").each(function(){var e=t(this);"slug"==e.attr("name")||e.val()?e.removeClass("error"):(e.addClass("error"),o=!0),l[e.attr("name")]=e.val()}),o||(n.addClass("is-active"),r.hide(),a.ajax.send("tawcvs_add_new_attribute",{data:l,error:function(t){n.removeClass("is-active"),r.addClass("error").text(t).show()},success:function(t){n.removeClass("is-active"),r.addClass("success").text(t.msg).show(),c.find("select.attribute_values").append('<option value="'+t.id+'" selected="selected">'+t.name+"</option>"),c.find("select.attribute_values").change(),e()}}))})});